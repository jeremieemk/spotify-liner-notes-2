{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport Discojs from 'discojs';\nexport default function useDiscogsData(spotifyData) {\n  _s();\n\n  var _useState = useState(null),\n      discogsData = _useState[0],\n      setDiscogsData = _useState[1];\n\n  useEffect(function () {\n    fetchDiscogsData(spotifyData, setDiscogsData);\n  }, [spotifyData]);\n\n  function fetchDiscogsData(spotifyData, setDiscogsData) {\n    var dicogsApi = new Discojs({\n      userToken: process.env.NEXT_PUBLIC_DISCOGS_KEY\n    });\n    var regex = /\\s*\\([^)]*\\)/g;\n    var currentTrack = spotifyData.name;\n    var cleanTrackName = currentTrack.name.includes(\"-\") ? currentTrack.name.replace(regex, \"\").replaceAll(\"&\", \"\").substring(0, currentTrack.name.indexOf(\"-\")) : currentTrack.name.replace(regex, \"\").replaceAll(\"&\", \"\");\n    var cleanArtistName = currentTrack.artists[0].name.replaceAll(\"&\", \"and\");\n    dicogsApi.searchDatabase({\n      // search uses only the first word of the artist name\n      // artist: spotifyTrackData.artists[0].name.replace(/ .*/, \"\"),\n      artist: cleanArtistName,\n      track: cleanTrackName,\n      type: \"release\"\n    }).then(function (data) {\n      console.log(\"discogs api data\", data); // checks if discogs search brings any result\n\n      if (data.results.length > 0) {\n        setDiscogsData(data.results);\n      } else {\n        console.log(\"no data\");\n      }\n    });\n  }\n\n  return discogsData;\n}\n\n_s(useDiscogsData, \"yzHMHPZkUAIxMeyy5PV0im/CSMY=\");","map":{"version":3,"sources":["/Users/jeremie/web/44_spotify-liner-notes2.0/pages/api/useDiscogsData.js"],"names":["useEffect","useState","Discojs","useDiscogsData","spotifyData","discogsData","setDiscogsData","fetchDiscogsData","dicogsApi","userToken","process","env","NEXT_PUBLIC_DISCOGS_KEY","regex","currentTrack","name","cleanTrackName","includes","replace","replaceAll","substring","indexOf","cleanArtistName","artists","searchDatabase","artist","track","type","then","data","console","log","results","length"],"mappings":";;AAAA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,OAAOC,OAAP,MAAoB,SAApB;AAEA,eAAe,SAASC,cAAT,CAAwBC,WAAxB,EAAqC;AAAA;;AAAA,kBACZH,QAAQ,CAAC,IAAD,CADI;AAAA,MAC3CI,WAD2C;AAAA,MAC9BC,cAD8B;;AAIlDN,EAAAA,SAAS,CAAC,YAAM;AACZO,IAAAA,gBAAgB,CAACH,WAAD,EAAcE,cAAd,CAAhB;AACH,GAFQ,EAEN,CAACF,WAAD,CAFM,CAAT;;AAIA,WAASG,gBAAT,CAA0BH,WAA1B,EAAuCE,cAAvC,EAAuD;AACnD,QAAME,SAAS,GAAG,IAAIN,OAAJ,CAAY;AAChCO,MAAAA,SAAS,EAAEC,OAAO,CAACC,GAAR,CAAYC;AADS,KAAZ,CAAlB;AAGA,QAAMC,KAAK,GAAG,eAAd;AACA,QAAMC,YAAY,GAAGV,WAAW,CAACW,IAAjC;AAEF,QAAMC,cAAc,GAAGF,YAAY,CAACC,IAAb,CAAkBE,QAAlB,CAA2B,GAA3B,IACrBH,YAAY,CAACC,IAAb,CACOG,OADP,CACeL,KADf,EACsB,EADtB,EAEOM,UAFP,CAEkB,GAFlB,EAEuB,EAFvB,EAGOC,SAHP,CAGiB,CAHjB,EAGoBN,YAAY,CAACC,IAAb,CAAkBM,OAAlB,CAA0B,GAA1B,CAHpB,CADqB,GAKrBP,YAAY,CAACC,IAAb,CACOG,OADP,CACeL,KADf,EACsB,EADtB,EAEOM,UAFP,CAEkB,GAFlB,EAEuB,EAFvB,CALF;AASF,QAAMG,eAAe,GAAGR,YAAY,CAACS,OAAb,CAAqB,CAArB,EAAwBR,IAAxB,CAA6BI,UAA7B,CAAwC,GAAxC,EAA6C,KAA7C,CAAxB;AAEAX,IAAAA,SAAS,CACNgB,cADH,CACkB;AACd;AACA;AACAC,MAAAA,MAAM,EAAEH,eAHM;AAIdI,MAAAA,KAAK,EAAEV,cAJO;AAKdW,MAAAA,IAAI,EAAE;AALQ,KADlB,EAQGC,IARH,CAQQ,UAACC,IAAD,EAAU;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCF,IAAhC,EADc,CAEd;;AACA,UAAIA,IAAI,CAACG,OAAL,CAAaC,MAAb,GAAsB,CAA1B,EAA6B;AAC3B3B,QAAAA,cAAc,CAACuB,IAAI,CAACG,OAAN,CAAd;AACD,OAFD,MAEO;AACLF,QAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACD;AACF,KAhBH;AAiBG;;AAED,SAAO1B,WAAP;AACH;;GA9CuBF,c","sourcesContent":["import { useEffect, useState } from \"react\";\nimport Discojs from 'discojs'\n\nexport default function useDiscogsData(spotifyData) {\n  const [discogsData, setDiscogsData] = useState(null);\n  \n\n  useEffect(() => {\n      fetchDiscogsData(spotifyData, setDiscogsData)\n  }, [spotifyData]);\n\n  function fetchDiscogsData(spotifyData, setDiscogsData) {\n      const dicogsApi = new Discojs({\n    userToken: process.env.NEXT_PUBLIC_DISCOGS_KEY,\n  });\n      const regex = /\\s*\\([^)]*\\)/g;\n      const currentTrack = spotifyData.name\n\n    const cleanTrackName = currentTrack.name.includes(\"-\") ?\n      currentTrack.name\n            .replace(regex, \"\")\n            .replaceAll(\"&\", \"\")\n            .substring(0, currentTrack.name.indexOf(\"-\")):\n      currentTrack.name\n            .replace(regex, \"\")\n            .replaceAll(\"&\", \"\")\n\n  const cleanArtistName = currentTrack.artists[0].name.replaceAll(\"&\", \"and\")\n\n  dicogsApi\n    .searchDatabase({\n      // search uses only the first word of the artist name\n      // artist: spotifyTrackData.artists[0].name.replace(/ .*/, \"\"),\n      artist: cleanArtistName,\n      track: cleanTrackName,\n      type: \"release\",\n    })\n    .then((data) => {\n      console.log(\"discogs api data\", data)\n      // checks if discogs search brings any result\n      if (data.results.length > 0) {\n        setDiscogsData(data.results)     \n      } else {\n        console.log(\"no data\")    \n      }\n    });\n    }\n\n    return discogsData\n}"]},"metadata":{},"sourceType":"module"}